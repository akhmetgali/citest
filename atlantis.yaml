version: 3
automerge: true
projects:
  - name: create-ec2
    dir: ./modules/create-ec2
    workspace: default
    terraform_version: v0.11.0
    apply_requirements: [approved, mergeable]
    autoplan:
      when_modified: ["*.tf", "../modules/**/*.tf"]
      enabled: true
    workflow: myworkflow

workflows:
  myworkflow:
    plan:
      steps:
        - run: echo "Test Plan"
        - init
        - plan
    apply:
      steps:
        - run: echo "test apply"
        - apply